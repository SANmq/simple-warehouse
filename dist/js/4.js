(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{392:function(e,t,s){},398:function(e,t,s){"use strict";var i=s(392);s.n(i).a},402:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add-good"},[s("el-steps",{staticStyle:{padding:"20px 100px"},attrs:{active:e.active,simple:"","finish-status":"success"}},[s("el-step",{attrs:{title:"基本信息"}}),e._v(" "),s("el-step",{attrs:{title:"参数信息"}}),e._v(" "),s("el-step",{attrs:{title:"商品图片"}})],1),e._v(" "),s("el-form",{attrs:{model:e.form,inline:"","label-width":"80px"},on:{submit:function(t){return t.preventDefault(),e.submitFrom(t)}}},[0===e.active?[s("el-form-item",{attrs:{label:"商品昵称"}},[s("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"商品分类"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.classify,callback:function(t){e.$set(e.form,"classify",t)},expression:"form.classify"}},e._l(e.classifyList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"商品备注"}},[s("el-input",{staticStyle:{width:"350px"},attrs:{type:"textarea",maxlength:"200","show-word-limit":"",autosize:{maxRows:10,minRows:10},resize:"none"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"商品数量"}},[s("el-input-number",{model:{value:e.form.number,callback:function(t){e.$set(e.form,"number",t)},expression:"form.number"}})],1)]:e._e(),e._v(" "),1===e.active?[e.form.classify?e._e():s("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.paramsTip))]),e._v(" "),e._l(e.form.parameters,(function(t,i){return s("el-form-item",{key:t.name,attrs:{label:t.name}},[s("el-input",{staticStyle:{width:"auto"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}}),e._v(" "),s("el-button",{attrs:{type:"danger",icon:"el-icon-remove"},on:{click:function(t){return e.form.parameters.splice(i,1)}}},[e._v("删除")])],1)})),e._v(" "),s("el-form-item",{staticStyle:{display:"block","text-align":"center"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:e.addParamItem}},[e._v("新增参数\n                ")])],1)]:e._e(),e._v(" "),2===e.active?[s("el-form-item",{staticClass:"picture-upload",attrs:{label:"商品图片","label-width":"100%"}},[s("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{limit:8,"on-exceed":e.exceed,multiple:!0,action:"/","file-list":e.fileList,"http-request":e.handleHttpRequest,"on-remove":e.handleRemove,"list-type":"picture-card","auto-upload":!1}},[s("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过2M,上传后此处暂时无法修改已上传图片")])]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("检查后点击这里确认上传图片")])],1)]:e._e(),e._v(" "),3===e.active?[s("div",{staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center","font-size":"40px"}},[s("div",[s("i",{class:e.isLoading?"el-icon-loading":e.result?"el-icon-success":"el-icon-error",style:"font-size: 50px;"+(e.isLoading?"":e.result?"color:green;":"color:red;")}),e._v("\n                    "+e._s(e.isLoading?"上传等待中。。。。":e.result?"上传成功":"上传失败")+"\n                ")])])]:e._e()],2),e._v(" "),s("div",{staticStyle:{"text-align":"center"}},[0!==e.active&&e.active<3?s("el-button",{on:{click:e.prev}},[e._v("上一项")]):e._e(),e._v(" "),2!==e.active&&e.active<3?s("el-button",{on:{click:e.next}},[e._v("下一项")]):e._e(),e._v(" "),2===e.active&&e.active<3?s("el-button",{on:{click:e.submitFrom}},[e._v("提交")]):e._e(),e._v(" "),3!==e.active||e.isLoading?e._e():s("el-button",{on:{click:e.complete}},[e._v("完成")])],1)],1)};i._withStripped=!0;var a=s(69),l={name:"AddGood",data:()=>({active:0,form:{nickname:"",classify:"",number:0,remark:"",parameters:[],imageUrlList:[]},paramsTip:"请先添加分类",isLoading:!0,result:!1,fileList:[]}),computed:{...Object(a.b)("config",["classifyList"]),...Object(a.b)(["localhost"])},watch:{"form.classify":{immediate:!0,handler(){let e=[];this.form.classify?e=this.classifyList.filter(e=>e.name===this.form.classify)[0].defaultParams:this.paramsTip="请先设置商品的分类",this.form.parameters=e.map(e=>({name:e.name,value:""})),console.log(this.form.parameters)}}},methods:{submitFrom(){this.active++,this.isLoading=!0,this.$http.put("/api/good/item",this.form).then(e=>{200===e.status?(this.isLoading=!1,this.result=!0,console.log(e.data)):this.result=!1},()=>{this.result=!1}),this.isLoading=!1},next(){if(this.form.classify&&this.form.nickname){if(0===this.active)return this.active++,null;if(this.form.parameters.length>0)return this.active++,null}this.$alert("请将当前表单添加完整后继续")},prev(){this.active--},addParamItem(){this.$prompt("请输入参数名称","输入",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{this.$message({type:"success",message:"添加"+e+"参数成功"},()=>{}),this.form.parameters.push({name:e,value:""})}).catch(()=>{this.$message({type:"info",message:"取消添加"})})},async handleRemove(e){if(0===this.fileList.length)return null;let t=0;for(let s of this.fileList){if(s.name===e.name)break;t++}try{if(200===(await this.$http.delete("/api/upload",{params:{imageUrl:this.form.imageUrlList[t]}})).status)return this.form.imageUrlList.splice(t,1),this.fileList.splice(t,1),this.$message({message:"删除成功",type:"success",duration:2e3}),null}catch(e){}this.$message({message:"删除失败",type:"info",duration:2e3});const s=this.fileList;this.fileList=[],this.fileList=s},exceed(){this.$alert("文件数量超出8个,请重新选择")},submitUpload(){console.log("测试上传方法"),this.imageForm=new FormData,this.$refs.upload.submit(),this.$http.post("/api/upload",this.imageForm).then(e=>{if(200===e.status){this.$message({type:"success",message:"成功"});for(let t of e.data)this.form.imageUrlList.push(t.url),this.fileList.push({name:t.name,url:this.localhost+"/upload/"+t.url})}else this.$message({type:"error",message:"上传失败"})},e=>{console.log(e),this.$message({type:"error",message:"上传失败"})})},handleHttpRequest(e){this.imageForm.append("imageUrl",e.file,e.file.name)},complete(){this.result&&(this.form={nickname:"",classify:"",remark:"",parameters:[],imageUrlList:[]}),this.active=0}}},r=(s(398),s(27)),o=Object(r.a)(l,i,[],!1,null,null,null);o.options.__file="src/components/manage/AddGood.vue";t.default=o.exports}}]);